<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css">
</head>

<style>
  @font-face {
  font-family: "Lexend Deca Regular";
  src: url(../fonts/LexendDecaRegular.woff) format("woff");
  font-weight: 400;
  font-style: normal;
  }

  html {
    background-color: #36393f;
    font-family: "Lexend Deca Regular";
  }

  body {
    margin: 0;
    min-width: 250px;
    font-family: "Lexend Deca Regular";
    background-color: #36393f;
  }

  .messages {
    color: #dde9f8;
    text-align: left;
  }
  
  .txt-msg {
    background-color: #26262b;
    border-radius: 10px;
    display: inline-block;
    padding: 10px;
    margin-left: 30%;
  }

  .main-content {
    text-align: center;
  }

  .your-msg {
    float: right;
    background:rgba(255, 93, 0, 1);
    margin-right: 30%;
  }
  
  input {
    background: linear-gradient(
    90deg,
    rgba(255, 93, 0, 1) 0,
    rgba(255, 217, 25, 1) 100%
  );
    border-radius: 10px;
    padding: 5px;
    padding-left: 20px;
    padding-right: 20px;
    margin-left: auto;
    margin-right: auto;
  }

  form {
    text-align: center;
    width: 100%;
    margin-bottom: 10px;
  }

  /* width */
  ::-webkit-scrollbar {
    width: 15px;
  }

  /* Track */
  ::-webkit-scrollbar-track {
    box-shadow: inset 0 0 5px grey;
    border-radius: 10px;
  }

  /* Handle */
  ::-webkit-scrollbar-thumb {
    background: linear-gradient(
      0deg,
      rgba(255, 93, 0, 1) 0,
      rgba(255, 217, 25, 1) 100%
    );
    border-radius: 10px;
  }
</style>

<body>
<div class="main-content">
<h1 style="color:#dde9f8;padding: 5px;">Chat:</h1>
<div class="messages" id="messages"></div>
<form id="formEE">
  <input style="display:inline-block;background: #dde9f8;width: 60%;" type="text" id="chat-input">
  <input class="submit-btn" style="display:inline-block; margin-left:10px; color: #dde9f8;" type="submit" value="Submit Message!">
</form> 

</div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js"></script>

<!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-analytics.js"></script>

<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-firestore.js"></script>
<script>
    var config = {
      apiKey: "AIzaSyAFsWpVKy1bjsOM07arnzk5UYIUZz7qxGY",
      authDomain: "httpsspark-2121.web.app/",
      databaseURL: "https://spark-2121.firebaseio.com/",
      projectId: "spark-2121"
    }
    if (firebase.apps.length === 0) {
      firebase.initializeApp(config)
    }
    var group = "cyberaegis"
    var database = firebase.database()
    var firestore = firebase.firestore()
    const auth = firebase.auth();
    var username = null
    var chatRef2 = null
    auth.onAuthStateChanged(function (user) {
      if (user !== null) {
        theuser = user
        var chatRef = firebase.database().ref('chat/' + group);
        chatRef2 = chatRef
        var docRef = firestore.collection("users").doc(user.uid);
        docRef.get().then(function (doc) {
          if (doc.exists) {
            if (doc.data().name !== undefined) {
              username = doc.data().name
            }
          }
          chatRef.on('child_added', function(data) {
            console.log(data.val())
            if (data.val().text.split(":")[0] === username) {
              document.getElementById("messages").innerHTML += "<p class='txt-msg your-msg'>" + data.val().text + "</p><br>"
            }
            else {
              document.getElementById("messages").innerHTML += "<p class='txt-msg'>" + data.val().text + "</p><br>"
            }
        });
        })
      }
      else {
        window.location.pathname = '/login'
      }
    })
    var form = document.getElementById("formEE")
    form.onsubmit = function submit (e) {
      e.preventDefault()
      if (username === null) {
          return;
      }
      if (chatRef2 === null) {
          return;
      }
      var text = username + ": " + document.getElementById("chat-input").value;
      document.getElementById("chat-input").value = ''
      console.log("text")
      var newchatref = chatRef2.push()
      newchatref.set({
          text: text
      })
    }
</script>